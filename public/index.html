<!DOCTYPE html>
<html>   
<head>
  <title>Visualização de informação</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="vistemp.js"></script>
    <style>
        /* AXES */
/* ticks */
.axis line{
stroke: #706f6f;
stroke-width: 0.5;
shape-rendering: crispEdges;
}

/* axis contour */
.axis path {
stroke: #706f6f;
stroke-width: 0.7;
shape-rendering: crispEdges;
}

/* axis text */
.axis text {
fill: #2b2929;
font-family: Georgia;
font-size: 100%;
}

.line {
    fill: none;
    stroke: #ffab00;
    stroke-width: 1;
}
  
.overlay {
  fill: none;
  pointer-events: all;
}

/* Style the dots by assigning a fill and stroke */
.dot {
    fill: #ffab00;
    stroke: #fff;
}
  
  .focus circle {
  fill: none;
  stroke: steelblue;
}
.tooltip {
fill: #2b2929;
font-family: Georgia;
font-size: 150%;
}

.point {
stroke: none;
fill: #9c9c9c;
}

    </style>
     
 
</head>
  
<body>
  <div class="container">
    <div class="p-4">
      <h1 class="text-center">CanSat2021 - Análise de dados</h1>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="temp">
          <label class="form-check-label" for="flexRadioDefault1">
            Temperatura do ar (t)
          </label>
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="press">
          <label class="form-check-label" for="flexRadioDefault1">
            Pressão atmosférica (t)
          </label>
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="flexRadioDefault" id="alt">
          <label class="form-check-label" for="flexRadioDefault1">
            Altitude (t)
          </label>
        </div>
      </div>
      
    </div>
    <div class="row">
      <div class="col-sm-3 mt-2">
        <label for="exampleFormControlInput1" class="form-label">Tmin:</label>
        <input type="email" class="form-control" id="valmin" placeholder="valor mínimo" value="0">    
      </div>
      <div class="col-sm-3 mt-2">
        <label for="exampleFormControlInput1" class="form-label">Tmax:</label>
        <input type="email" class="form-control" id="valmax" placeholder="valor mínimo" value="800">    
      </div>
    </div>
    <div class="shadow p-3 mb-5 bg-body rounded mt-4" id="chart">
      <!--vis here-->
    </div>
  </div>
</body>
</html>

<script>
  const margin = {
      top: 10,
      right: 50,
      bottom: 50,
      left: 50
  };
  const width = 600 - margin.left - margin.right;
  const height = 300 - margin.top - margin.bottom;

  let valmin = document.getElementById('valmin')
  let valmax = document.getElementById('valmax')
  let t = document.getElementById('temp')
  let p = document.getElementById('press')
  let a = document.getElementById('alt')
  document.getElementById('chart').style.display = 'none'

  function convertJson(file, callback) {
    d3.json(file)
    .then(data=>{
      callback(data)
    })
    .catch(error=>{
      if (error) throw error
    })
  }

  convertJson('data.json',(data) => {
    console.log(data)
    console.log(data.length)

    t.addEventListener('change', () => {
      if (t.checked) {
        document.getElementById('chart').style.display = 'block'
        tempVis(data,valmin,valmax)
        valmin.addEventListener('change', () => {
          tempVis(data,valmin,valmax)
        })
        valmax.addEventListener('change', () => {
          tempVis(data,valmin,valmax)
        })

      /*MAXTEMP = 0
      getMaxTemp(data, (maxValue) => {
        MAXTEMP = maxValue + 1
      })

      console.log(MAXTEMP)

      const svg = d3.select('#chart')
        .append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .call(responsivefy) // Call responsivefy to make the chart responsive
        .append('g')
        .attr('transform', `translate(${margin.left}, ${margin.top})`);

      const xScale = d3.scaleLinear().range([0,width]);
      const yScale = d3.scaleLinear().range([height, 0]);

      xScale.domain([0,800]);
      yScale.domain([20,30]);

      const yaxis = d3.axisLeft().scale(yScale); 
      const xaxis = d3.axisBottom().scale(xScale);

      svg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xaxis);

      svg.append("g")
        .attr("class", "axis")
        .call(yaxis);


      var line = d3.line()
        .x(function(d, i) { return xScale(d.Time); }) // set the x values for the line generator
        .y(function(d) { return yScale(d.temp); }) // set the y values for the line generator 
        .curve(d3.curveMonotoneX) // apply smoothing to the line

      //add line
      svg.append("path")
        .datum(data) // 10. Binds data to the line 
        .attr("class", "line") // Assign a class for styling 
        .attr("d", line); // 11. Calls the line generator 

      const area = d3
        .area()
        .x(data => xScale(data.Time))
        .y0(height)
        .y1(data => yScale(data.temp));

      svg
        .append("path")
        .attr("transform", `translate(0,0)`)
        .datum(data)
        .style("fill", "lightblue")
        .attr("stroke", "steelblue")
        .attr("stroke-linejoin", "round")
        .attr("stroke-linecap", "round")
        .attr("stroke-width", 1)
        .attr("d", area);

      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - margin.left)
        .attr("x",0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .style("font-size","10px")
        .text("Temperatura (C)");

      svg.append("text")             
        .attr("transform", "translate(" + (width/2) + " ," + (height + margin.top + 20) + ")")
        .style("text-anchor", "middle")
        .style("font-size","10px")
        .text("Tempo (s)");

      var bisect = d3.bisector(d => d.Time).left;

      //tooltip

      var focus = svg
        .append('g')
        .append('circle')
        .style("fill", "red")
        .attr("stroke", "black")
        .attr('r', 2)
        .style("opacity", 0)

      var focusText = svg
        .append('g')
        .append('text') 
        .style("opacity", 0)
        .attr("text-anchor", "left")
        .attr("alignment-baseline", "middle")


      svg
        .append('rect')
        .style("fill", "none")
        .style("pointer-events", "all")
        .attr('width', width)
        .attr('height', height)
        .on('mouseover', mouseover)
        .on('mousemove', mousemove)
        .on('mouseout', mouseout);

      function mouseover() {
        focus.style("opacity", 1)
        focusText.style("opacity",1)
      }


      function mousemove() {
      // recover coordinate we need
      var x0 = xScale.invert(d3.mouse(this)[0]);
      var i = bisect(data, x0, 1);
      selectedData = data[i]
      focus
        .attr("cx", xScale(selectedData.Time))
        .attr("cy", yScale(selectedData.temp))
      focusText
        .html(selectedData.temp)
        .attr("x", xScale(selectedData.Time)+5)
        .attr("y", yScale(selectedData.temp))
        .style("font-size","8px")
      }

      function mouseout() {
      focus.style("opacity", 0)
      focusText.style("opacity", 0)
      }

      function responsivefy(svg) {
      const container = d3.select(svg.node().parentNode),
        width = parseInt(svg.style('width'), 10),
        height = parseInt(svg.style('height'), 10),
        aspect = width / height;
        svg.attr('viewBox', `0 0 ${width} ${height}`).
        attr('preserveAspectRatio', 'xMinYMid').
        call(resize); 
        d3.select(window).on('resize.' + container.attr('id'), resize);
        function resize() {
            const targetWidth = parseInt(container.style('width'));
            svg.attr('width', targetWidth);
            svg.attr('height', Math.round(targetWidth / aspect));
        }
      }*/
              
            }
          })
  })
   
   
  
</script>